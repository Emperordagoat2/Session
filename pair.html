<!DOCTYPE html>
<html lang="en" class=""> <!-- class="dark" will be added here by JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Pairing</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Set theme on initial load to prevent Flash of Un-styled Content (FOUC)
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        /* Custom scrollbar for a better look */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark .custom-scrollbar::-webkit-scrollbar-track { background: #2d3748; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        body { font-family: 'Inter', sans-serif; }
        .step { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        .step-hidden { opacity: 0; transform: translateY(20px); position: absolute; width: 100%; pointer-events: none; }
         .code-display {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-300">

    <div class="w-full max-w-md mx-auto p-4">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl relative overflow-hidden" style="min-height: 380px;">
           <!-- Theme Toggle Dropdown -->
            <div class="absolute top-4 right-4">
                <button id="theme-toggle-btn" class="p-2 rounded-lg text-slate-500 dark:text-slate-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                     <!-- Icons will be injected by JS -->
                </button>
                <div id="theme-dropdown" class="absolute right-0 mt-2 w-36 bg-white/80 dark:bg-gray-700/80 backdrop-blur-lg border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg hidden z-30">
                    <button data-theme="light" class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-gray-600">Light</button>
                    <button data-theme="dark" class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-gray-600">Dark</button>
                    <button data-theme="system" class="theme-option w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-gray-600">System</button>
                </div>
            </div>
            
            <!-- Step 1: Choose Country -->
            <div id="step-1" class="step">
                <h1 class="text-2xl font-bold text-center text-gray-800 dark:text-gray-100 mb-2">Select Your Country</h1>
                <p class="text-center text-gray-500 dark:text-gray-400 mb-6">Choose your country to begin pairing.</p>
                <div id="country-selector" class="relative">
                    <button id="dropdown-button" type="button" class="w-full flex items-center justify-between h-14 px-4 py-2 text-gray-700 dark:text-gray-200 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <div class="flex items-center">
                            <span id="selected-country-flag" class="text-2xl mr-3"></span>
                            <span id="selected-country-name" class="font-semibold text-base"></span>
                        </div>
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="dropdown-menu" class="absolute mt-2 w-full max-h-80 overflow-y-auto bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-xl hidden custom-scrollbar z-20">
                        <div class="p-2 sticky top-0 bg-white dark:bg-gray-700 z-10">
                            <input id="search-box" type="text" placeholder="Search for your country..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-400">
                        </div>
                        <ul id="country-list" class="divide-y divide-gray-200 dark:divide-gray-600"></ul>
                    </div>
                </div>
            </div>

            <!-- Step 2: Input Phone Number -->
            <div id="step-2" class="step step-hidden">
                <button id="back-btn" class="absolute top-4 left-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <h1 class="text-2xl font-bold text-center text-gray-800 dark:text-gray-100 mb-2">Enter Your Number</h1>
                <p class="text-center text-gray-500 dark:text-gray-400 mb-6">We'll send a pairing code to this number.</p>
                <div class="flex items-center border border-gray-300 dark:border-gray-600 rounded-lg focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-indigo-500 transition duration-200">
                    <div class="flex items-center justify-center w-28 h-14 px-3 py-2 text-gray-700 dark:text-gray-200 bg-gray-50 dark:bg-gray-700 rounded-l-lg">
                        <span id="phone-country-flag" class="text-2xl mr-2"></span>
                        <span id="phone-country-code" class="font-semibold text-sm"></span>
                    </div>
                    <input type="tel" id="phone-input" class="w-full h-14 px-3 py-2 border-l border-gray-300 dark:border-gray-600 focus:outline-none rounded-r-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-800 placeholder-gray-400 dark:placeholder-gray-500">
                </div>
                <div id="error-message" class="text-red-500 dark:text-red-400 text-sm mt-2 h-5"></div>
                <button id="verify-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg mt-4 hover:bg-indigo-700 transition duration-300 disabled:bg-gray-400 dark:disabled:bg-gray-600">Get Pairing Code</button>
            </div>

            <!-- Step 3: Confirmation -->
            <div id="step-3" class="step step-hidden text-center">
                <div class="mx-auto bg-green-100 dark:bg-green-900/50 rounded-full w-20 h-20 flex items-center justify-center mb-4">
                     <svg class="w-12 h-12 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2">Pairing Code Sent!</h1>
                <p class="text-gray-600 dark:text-gray-400 mb-4">A code has been sent to your number.</p>
                <div class="code-display p-6 rounded-xl text-center cursor-pointer" onclick="copyCode()">
                    <p class="text-white font-bold text-xl">Pairing Code</p>
                    <p id="pairing-code" class="text-white text-3xl font-mono mt-2 tracking-wider"></p>
                    <p id="copy-status" class="text-white/80 text-sm mt-2">Click to copy</p>
                </div>
                <button id="start-over-btn" class="w-full bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-100 dark:hover:bg-gray-500 font-bold py-3 px-4 rounded-lg mt-6 transition duration-300">Start Over</button>
            </div>
        </div>
    </div>

    <script>
        const elements = {
            steps: [document.getElementById('step-1'), document.getElementById('step-2'), document.getElementById('step-3')],
            dropdownButton: document.getElementById('dropdown-button'),
            dropdownMenu: document.getElementById('dropdown-menu'),
            countryList: document.getElementById('country-list'),
            searchBox: document.getElementById('search-box'),
            selectedCountryFlag: document.getElementById('selected-country-flag'),
            selectedCountryName: document.getElementById('selected-country-name'),
            phoneInput: document.getElementById('phone-input'),
            phoneCountryFlag: document.getElementById('phone-country-flag'),
            phoneCountryCode: document.getElementById('phone-country-code'),
            verifyBtn: document.getElementById('verify-btn'),
            errorMessage: document.getElementById('error-message'),
            backBtn: document.getElementById('back-btn'),
            pairingCodeEl: document.getElementById('pairing-code'),
            startOverBtn: document.getElementById('start-over-btn'),
            copyStatus: document.getElementById('copy-status'),
            themeToggleBtn: document.getElementById('theme-toggle-btn'),
            themeDropdown: document.getElementById('theme-dropdown'),
            themeOptions: document.querySelectorAll('.theme-option'),
        };

         const icons = {
            light: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`,
            dark: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`,
            system: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>`
        };

        const countryData = [ { name: "Afghanistan", dial_code: "+93", flag: "🇦🇫", length: 9, format: "## ### ####" }, { name: "Albania", dial_code: "+355", flag: "🇦🇱", length: 9, format: "### ### ###" }, { name: "Algeria", dial_code: "+213", flag: "🇩🇿", length: 9, format: "### ## ## ##" }, { name: "American Samoa", dial_code: "+1-684", flag: "🇦🇸", length: 10, format: "###-###-####" }, { name: "Andorra", dial_code: "+376", flag: "🇦🇩", length: 6, format: "### ###" }, { name: "Angola", dial_code: "+244", flag: "🇦🇴", length: 9, format: "### ### ###" }, { name: "Anguilla", dial_code: "+1-264", flag: "🇦🇮", length: 10, format: "###-###-####" }, { name: "Antigua and Barbuda", dial_code: "+1-268", flag: "🇦🇬", length: 10, format: "###-###-####" }, { name: "Argentina", dial_code: "+54", flag: "🇦🇷", length: 10, format: "## #### ####" }, { name: "Armenia", dial_code: "+374", flag: "🇦🇲", length: 8, format: "## ######" }, { name: "Australia", dial_code: "+61", flag: "🇦🇺", length: 9, format: "# #### ####" }, { name: "Austria", dial_code: "+43", flag: "🇦🇹", length: 10, format: "### #######" }, { name: "Azerbaijan", dial_code: "+994", flag: "🇦🇿", length: 9, format: "## ### ## ##" }, { name: "Bahamas", dial_code: "+1-242", flag: "🇧🇸", length: 10, format: "###-###-####" }, { name: "Bahrain", dial_code: "+973", flag: "🇧🇭", length: 8, format: "#### ####" }, { name: "Bangladesh", dial_code: "+880", flag: "🇧🇩", length: 10, format: "####-######" }, { name: "Barbados", dial_code: "+1-246", flag: "🇧🇧", length: 10, format: "###-###-####" }, { name: "Belarus", dial_code: "+375", flag: "🇧🇾", length: 9, format: "## ###-##-##" }, { name: "Belgium", dial_code: "+32", flag: "🇧🇪", length: 9, format: "### ## ## ##" }, { name: "Belize", dial_code: "+501", flag: "🇧🇿", length: 7, format: "###-####" }, { name: "Benin", dial_code: "+229", flag: "🇧🇯", length: 8, format: "## ## ####" }, { name: "Bermuda", dial_code: "+1-441", flag: "🇧🇲", length: 10, format: "###-###-####" }, { name: "Bhutan", dial_code: "+975", flag: "🇧🇹", length: 8, format: "## ### ###" }, { name: "Bolivia", dial_code: "+591", flag: "🇧🇴", length: 8, format: "# ###-####" }, { name: "Bosnia and Herzegovina", dial_code: "+387", flag: "🇧🇦", length: 8, format: "## ###-###" }, { name: "Botswana", dial_code: "+267", flag: "🇧🇼", length: 8, format: "## ### ###" }, { name: "Brazil", dial_code: "+55", flag: "🇧🇷", length: 11, format: "## #####-####" }, { name: "Brunei", dial_code: "+673", flag: "🇧🇳", length: 7, format: "###-####" }, { name: "Bulgaria", dial_code: "+359", flag: "🇧🇬", length: 9, format: "### ### ###" }, { name: "Burkina Faso", dial_code: "+226", flag: "🇧🇫", length: 8, format: "## ## ####" }, { name: "Burundi", dial_code: "+257", flag: "🇧🇮", length: 8, format: "## ## ####" }, { name: "Cambodia", dial_code: "+855", flag: "🇰🇭", length: 9, format: "## ### ###" }, { name: "Cameroon", dial_code: "+237", flag: "🇨🇲", length: 9, format: "#### ####" }, { name: "Canada", dial_code: "+1", flag: "🇨🇦", length: 10, format: "###-###-####" }, { name: "Cape Verde", dial_code: "+238", flag: "🇨🇻", length: 7, format: "### ## ##" }, { name: "Cayman Islands", dial_code: "+1-345", flag: "🇰🇾", length: 10, format: "###-###-####" }, { name: "Central African Republic", dial_code: "+236", flag: "🇨🇫", length: 8, format: "## ## ####" }, { name: "Chad", dial_code: "+235", flag: "🇹🇩", length: 8, format: "## ## ## ##" }, { name: "Chile", dial_code: "+56", flag: "🇨🇱", length: 9, format: "# #### ####" }, { name: "China", dial_code: "+86", flag: "🇨🇳", length: 11, format: "### #### ####" }, { name: "Colombia", dial_code: "+57", flag: "🇨🇴", length: 10, format: "### #######" }, { name: "Comoros", dial_code: "+269", flag: "🇰🇲", length: 7, format: "### ## ##" }, { name: "Congo (Brazzaville)", dial_code: "+242", flag: "🇨🇬", length: 9, format: "## ### ####" }, { name: "Congo (Kinshasa)", dial_code: "+243", flag: "🇨🇩", length: 9, format: "## ### ####" }, { name: "Costa Rica", dial_code: "+506", flag: "🇨🇷", length: 8, format: "#### ####" }, { name: "Croatia", dial_code: "+385", flag: "🇭🇷", length: 9, format: "## ### ####" }, { name: "Cuba", dial_code: "+53", flag: "🇨🇺", length: 8, format: "# ### ####" }, { name: "Cyprus", dial_code: "+357", flag: "🇨🇾", length: 8, format: "## ######" }, { name: "Czech Republic", dial_code: "+420", flag: "🇨🇿", length: 9, format: "### ### ###" }, { name: "Denmark", dial_code: "+45", flag: "🇩🇰", length: 8, format: "## ## ## ##" }, { name: "Djibouti", dial_code: "+253", flag: "🇩🇯", length: 6, format: "## ## ##" }, { name: "Dominica", dial_code: "+1-767", flag: "🇩🇲", length: 10, format: "###-###-####" }, { name: "Dominican Republic", dial_code: "+1-809", flag: "🇩🇴", length: 10, format: "###-###-####" }, { name: "Ecuador", dial_code: "+593", flag: "🇪🇨", length: 9, format: "# ### ####" }, { name: "Egypt", dial_code: "+20", flag: "🇪🇬", length: 10, format: "## ### ####" }, { name: "El Salvador", dial_code: "+503", flag: "🇸🇻", length: 8, format: "#### ####" }, { name: "Equatorial Guinea", dial_code: "+240", flag: "🇬🇶", length: 9, format: "### ### ###" }, { name: "Eritrea", dial_code: "+291", flag: "🇪🇷", length: 7, format: "# ### ###" }, { name: "Estonia", dial_code: "+372", flag: "🇪🇪", length: 8, format: "### ####" }, { name: "Eswatini", dial_code: "+268", flag: "🇸🇿", length: 8, format: "#### ####" }, { name: "Ethiopia", dial_code: "+251", flag: "🇪🇹", length: 9, format: "## ### ####" }, { name: "Fiji", dial_code: "+679", flag: "🇫🇯", length: 7, format: "### ####" }, { name: "Finland", dial_code: "+358", flag: "🇫🇮", length: 10, format: "## ### ####" }, { name: "France", dial_code: "+33", flag: "🇫🇷", length: 9, format: "# ## ## ## ##" }, { name: "Gabon", dial_code: "+241", flag: "🇬🇦", length: 8, format: "# ## ## ##" }, { name: "Gambia", dial_code: "+220", flag: "🇬🇲", length: 7, format: "### ####" }, { name: "Georgia", dial_code: "+995", flag: "🇬🇪", length: 9, format: "### ## ## ##" }, { name: "Germany", dial_code: "+49", flag: "🇩🇪", length: 11, format: "### #######" }, { name: "Ghana", dial_code: "+233", flag: "🇬🇭", length: 9, format: "## ### ####" }, { name: "Greece", dial_code: "+30", flag: "🇬🇷", length: 10, format: "### #######" }, { name: "Grenada", dial_code: "+1-473", flag: "🇬🇩", length: 10, format: "###-###-####" }, { name: "Guatemala", dial_code: "+502", flag: "🇬🇹", length: 8, format: "# ### ####" }, { name: "Guinea", dial_code: "+224", flag: "🇬🇳", length: 9, format: "### ### ###" }, { name: "Guinea-Bissau", dial_code: "+245", flag: "🇬🇼", length: 7, format: "# ######" }, { name: "Guyana", dial_code: "+592", flag: "🇬🇾", length: 7, format: "### ####" }, { name: "Haiti", dial_code: "+509", flag: "🇭🇹", length: 8, format: "## ## ####" }, { name: "Honduras", dial_code: "+504", flag: "🇭🇳", length: 8, format: "####-####" }, { name: "Hungary", dial_code: "+36", flag: "🇭🇺", length: 9, format: "## ### ####" }, { name: "Iceland", dial_code: "+354", flag: "🇮🇸", length: 7, format: "### ####" }, { name: "India", dial_code: "+91", flag: "🇮🇳", length: 10, format: "##### #####" }, { name: "Indonesia", dial_code: "+62", flag: "🇮🇩", length: 11, format: "###-###-####" }, { name: "Iran", dial_code: "+98", flag: "🇮🇷", length: 10, format: "### ### ####" }, { name: "Iraq", dial_code: "+964", flag: "🇮🇶", length: 10, format: "### ### ####" }, { name: "Ireland", dial_code: "+353", flag: "🇮🇪", length: 9, format: "## ### ####" }, { name: "Israel", dial_code: "+972", flag: "🇮🇱", length: 9, format: "##-###-####" }, { name: "Italy", dial_code: "+39", flag: "🇮🇹", length: 10, format: "### #######" }, { name: "Ivory Coast", dial_code: "+225", flag: "🇨🇮", length: 10, format: "## ## ## ####" }, { name: "Jamaica", dial_code: "+1-876", flag: "🇯🇲", length: 10, format: "###-###-####" }, { name: "Japan", dial_code: "+81", flag: "🇯🇵", length: 10, format: "##-####-####" }, { name: "Jordan", dial_code: "+962", flag: "🇯🇴", length: 9, format: "# #### ####" }, { name: "Kazakhstan", dial_code: "+7", flag: "🇰🇿", length: 10, format: "### ### ## ##" }, { name: "Kenya", dial_code: "+254", flag: "🇰🇪", length: 9, format: "### ######" }, { name: "Kiribati", dial_code: "+686", flag: "🇰🇮", length: 8, format: "## ### ###" }, { name: "Kuwait", dial_code: "+965", flag: "🇰🇼", length: 8, format: "#### ####" }, { name: "Kyrgyzstan", dial_code: "+996", flag: "🇰🇬", length: 9, format: "### ######" }, { name: "Laos", dial_code: "+856", flag: "🇱🇦", length: 10, format: "## ## ### ###" }, { name: "Latvia", dial_code: "+371", flag: "🇱🇻", length: 8, format: "## ### ###" }, { name: "Lebanon", dial_code: "+961", flag: "🇱🇧", length: 8, format: "## ### ###" }, { name: "Lesotho", dial_code: "+266", flag: "🇱🇸", length: 8, format: "## ### ###" }, { name: "Liberia", dial_code: "+231", flag: "🇱🇷", length: 8, format: "## ### ####" }, { name: "Libya", dial_code: "+218", flag: "🇱🇾", length: 9, format: "##-#######" }, { name: "Liechtenstein", dial_code: "+423", flag: "🇱🇮", length: 7, format: "### ####" }, { name: "Lithuania", dial_code: "+370", flag: "🇱🇹", length: 8, format: "### #####" }, { name: "Luxembourg", dial_code: "+352", flag: "🇱🇺", length: 9, format: "### ### ###" }, { name: "Madagascar", dial_code: "+261", flag: "🇲🇬", length: 9, format: "## ## ### ##" }, { name: "Malawi", dial_code: "+265", flag: "🇲🇼", length: 9, format: "# #### ####" }, { name: "Malaysia", dial_code: "+60", flag: "🇲🇾", length: 10, format: "##-### ####" }, { name: "Maldives", dial_code: "+960", flag: "🇲🇻", length: 7, format: "###-####" }, { name: "Mali", dial_code: "+223", flag: "🇲🇱", length: 8, format: "## ## ####" }, { name: "Malta", dial_code: "+356", flag: "🇲🇹", length: 8, format: "#### ####" }, { name: "Marshall Islands", dial_code: "+692", flag: "🇲🇭", length: 7, format: "###-####" }, { name: "Mauritania", dial_code: "+222", flag: "🇲🇷", length: 8, format: "## ## ####" }, { name: "Mauritius", dial_code: "+230", flag: "🇲🇺", length: 8, format: "### ####" }, { name: "Mexico", dial_code: "+52", flag: "🇲🇽", length: 10, format: "### ### ####" }, { name: "Micronesia", dial_code: "+691", flag: "🇫🇲", length: 7, format: "### ####" }, { name: "Moldova", dial_code: "+373", flag: "🇲🇩", length: 8, format: "#### ####" }, { name: "Monaco", dial_code: "+377", flag: "🇲🇨", length: 9, format: "## ## ## ## ##" }, { name: "Mongolia", dial_code: "+976", flag: "🇲🇳", length: 8, format: "## ## ####" }, { name: "Montenegro", dial_code: "+382", flag: "🇲🇪", length: 8, format: "## ### ###" }, { name: "Morocco", dial_code: "+212", flag: "🇲🇦", length: 9, format: "##-#######" }, { name: "Mozambique", dial_code: "+258", flag: "🇲🇿", length: 9, format: "## ### ####" }, { name: "Myanmar", dial_code: "+95", flag: "🇲🇲", length: 9, format: "# ### ###" }, { name: "Namibia", dial_code: "+264", flag: "🇳🇦", length: 9, format: "## ### ####" }, { name: "Nauru", dial_code: "+674", flag: "🇳🇷", length: 7, format: "### ####" }, { name: "Nepal", dial_code: "+977", flag: "🇳🇵", length: 10, format: "##-#######" }, { name: "Netherlands", dial_code: "+31", flag: "🇳🇱", length: 9, format: "# ## ## ## ##" }, { name: "New Zealand", dial_code: "+64", flag: "🇳🇿", length: 9, format: "### ### ###" }, { name: "Nicaragua", dial_code: "+505", flag: "🇳🇮", length: 8, format: "#### ####" }, { name: "Niger", dial_code: "+227", flag: "🇳🇪", length: 8, format: "## ## ####" }, { name: "Nigeria", dial_code: "+234", flag: "🇳🇬", length: 10, format: "### ### ####" }, { name: "North Macedonia", dial_code: "+389", flag: "🇲🇰", length: 8, format: "## ### ###" }, { name: "Norway", dial_code: "+47", flag: "🇳🇴", length: 8, format: "### ## ###" }, { name: "Oman", dial_code: "+968", flag: "🇴🇲", length: 8, format: "#### ####" }, { name: "Pakistan", dial_code: "+92", flag: "🇵🇰", length: 10, format: "###-#######" }, { name: "Palau", dial_code: "+680", flag: "🇵🇼", length: 7, format: "### ####" }, { name: "Palestine", dial_code: "+970", flag: "🇵🇸", length: 9, format: "## ### ####" }, { name: "Panama", dial_code: "+507", flag: "🇵🇦", length: 8, format: "####-####" }, { name: "Papua New Guinea", dial_code: "+675", flag: "🇵🇬", length: 8, format: "### ## ###" }, { name: "Paraguay", dial_code: "+595", flag: "🇵🇾", length: 9, format: "### ######" }, { name: "Peru", dial_code: "+51", flag: "🇵🇪", length: 9, format: "### ### ###" }, { name: "Philippines", dial_code: "+63", flag: "🇵🇭", length: 10, format: "### #######" }, { name: "Poland", dial_code: "+48", flag: "🇵🇱", length: 9, format: "###-###-###" }, { name: "Portugal", dial_code: "+351", flag: "🇵🇹", length: 9, format: "## ### ####" }, { name: "Qatar", dial_code: "+974", flag: "🇶🇦", length: 8, format: "#### ####" }, { name: "Romania", dial_code: "+40", flag: "🇷🇴", length: 9, format: "## ### ####" }, { name: "Russia", dial_code: "+7", flag: "🇷🇺", length: 10, format: "### ###-##-##" }, { name: "Rwanda", dial_code: "+250", flag: "🇷🇼", length: 9, format: "### ### ###" }, { name: "Saint Kitts and Nevis", dial_code: "+1-869", flag: "🇰🇳", length: 10, format: "###-###-####" }, { name: "Saint Lucia", dial_code: "+1-758", flag: "🇱🇨", length: 10, format: "###-###-####" }, { name: "Saint Vincent and the Grenadines", dial_code: "+1-784", flag: "🇻🇨", length: 10, format: "###-###-####" }, { name: "Samoa", dial_code: "+685", flag: "🇼🇸", length: 7, format: "##-####" }, { name: "San Marino", dial_code: "+378", flag: "🇸🇲", length: 10, format: "#### ######" }, { name: "Sao Tome and Principe", dial_code: "+239", flag: "🇸🇹", length: 7, format: "### ####" }, { name: "Saudi Arabia", dial_code: "+966", flag: "🇸🇦", length: 9, format: "## ### ####" }, { name: "Senegal", dial_code: "+221", flag: "🇸🇳", length: 9, format: "## ### ## ##" }, { name: "Serbia", dial_code: "+381", flag: "🇷🇸", length: 9, format: "## #######" }, { name: "Seychelles", dial_code: "+248", flag: "🇸🇨", length: 7, format: "# ### ###" }, { name: "Sierra Leone", dial_code: "+232", flag: "🇸🇱", length: 8, format: "## ######" }, { name: "Singapore", dial_code: "+65", flag: "🇸🇬", length: 8, format: "#### ####" }, { name: "Slovakia", dial_code: "+421", flag: "🇸🇰", length: 9, format: "### ### ###" }, { name: "Slovenia", dial_code: "+386", flag: "🇸🇮", length: 8, format: "## ### ###" }, { name: "Solomon Islands", dial_code: "+677", flag: "🇸🇧", length: 7, format: "#######" }, { name: "Somalia", dial_code: "+252", flag: "🇸🇴", length: 8, format: "## ### ###" }, { name: "South Africa", dial_code: "+27", flag: "🇿🇦", length: 9, format: "## ### ####" }, { name: "South Korea", dial_code: "+82", flag: "🇰🇷", length: 11, format: "##-####-####" }, { name: "South Sudan", dial_code: "+211", flag: "🇸🇸", length: 9, format: "### ### ###" }, { name: "Spain", dial_code: "+34", flag: "🇪🇸", length: 9, format: "### ### ###" }, { name: "Sri Lanka", dial_code: "+94", flag: "🇱🇰", length: 9, format: "## ### ####" }, { name: "Sudan", dial_code: "+249", flag: "🇸🇩", length: 9, format: "## ### ####" }, { name: "Suriname", dial_code: "+597", flag: "🇸🇷", length: 7, format: "###-####" }, { name: "Sweden", dial_code: "+46", flag: "🇸🇪", length: 9, format: "##-### ## ##" }, { name: "Switzerland", dial_code: "+41", flag: "🇨🇭", length: 9, format: "## ### ## ##" }, { name: "Syria", dial_code: "+963", flag: "🇸🇾", length: 9, format: "## #### ###" }, { name: "Taiwan", dial_code: "+886", flag: "🇹🇼", length: 9, format: "# #### ####" }, { name: "Tajikistan", dial_code: "+992", flag: "🇹🇯", length: 9, format: "## ### ## ##" }, { name: "Tanzania", dial_code: "+255", flag: "🇹🇿", length: 9, format: "## ### ####" }, { name: "Thailand", dial_code: "+66", flag: "🇹🇭", length: 9, format: "## ### ####" }, { name: "Timor-Leste", dial_code: "+670", flag: "🇹🇱", length: 8, format: "### ####" }, { name: "Togo", dial_code: "+228", flag: "🇹🇬", length: 8, format: "## ## ####" }, { name: "Tonga", dial_code: "+676", flag: "🇹🇴", length: 7, format: "#####" }, { name: "Trinidad and Tobago", dial_code: "+1-868", flag: "🇹🇹", length: 10, format: "###-####" }, { name: "Tunisia", dial_code: "+216", flag: "🇹🇳", length: 8, format: "## ### ###" }, { name: "Turkey", dial_code: "+90", flag: "🇹🇷", length: 10, format: "### ### ## ##" }, { name: "Turkmenistan", dial_code: "+993", flag: "🇹🇲", length: 8, format: "## ######" }, { name: "Turks and Caicos Islands", dial_code: "+1-649", flag: "🇹🇨", length: 10, format: "###-####" }, { name: "Tuvalu", dial_code: "+688", flag: "🇹🇻", length: 6, format: "######" }, { name: "Uganda", dial_code: "+256", flag: "🇺🇬", length: 9, format: "### ######" }, { name: "Ukraine", dial_code: "+380", flag: "🇺🇦", length: 9, format: "## ### ## ##" }, { name: "United Arab Emirates", dial_code: "+971", flag: "🇦🇪", length: 9, format: "## ### ####" }, { name: "United Kingdom", dial_code: "+44", flag: "🇬🇧", length: 10, format: "#### ######" }, { name: "United States", dial_code: "+1", flag: "🇺🇸", length: 10, format: "###-###-####" }, { name: "Uruguay", dial_code: "+598", flag: "🇺🇾", length: 8, format: "# ### ## ##" }, { name: "Uzbekistan", dial_code: "+998", flag: "🇺🇿", length: 9, format: "## ### ## ##" }, { name: "Vanuatu", dial_code: "+678", flag: "🇻🇺", length: 7, format: "#######" }, { name: "Vatican City", dial_code: "+379", flag: "🇻🇦", length: 10, format: "#### ######" }, { name: "Venezuela", dial_code: "+58", flag: "🇻🇪", length: 10, format: "###-#######" }, { name: "Vietnam", dial_code: "+84", flag: "🇻🇳", length: 9, format: "## ### ####" }, { name: "Yemen", dial_code: "+967", flag: "🇾🇪", length: 9, format: "### ### ###" }, { name: "Zambia", dial_code: "+260", flag: "🇿🇲", length: 9, format: "## ### ####" }, { name: "Zimbabwe", dial_code: "+263", flag: "🇿🇼", length: 9, format: "## ### ####" }, ];

        let selectedCountry = countryData.find(c => c.name === "United States");
        let currentStep = 0;

        function showStep(stepIndex) {
            elements.steps.forEach((step, index) => {
                if (index === stepIndex) step.classList.remove('step-hidden');
                else step.classList.add('step-hidden');
            });
            currentStep = stepIndex;
        }

        function populateCountryList(filteredCountries) {
            elements.countryList.innerHTML = '';
            filteredCountries.forEach(country => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <button type="button" class="w-full flex items-center px-4 py-3 text-left text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-600 transition duration-150">
                        <span class="text-2xl mr-3">${country.flag}</span>
                        <span class="flex-1">${country.name}</span>
                        <span class="text-gray-500 dark:text-gray-400 text-sm">${country.dial_code}</span>
                    </button>`;
                listItem.addEventListener('click', () => selectCountry(country));
                elements.countryList.appendChild(listItem);
            });
        }

        function selectCountry(country) {
            selectedCountry = country;
            elements.selectedCountryFlag.textContent = country.flag;
            elements.selectedCountryName.textContent = country.name;
            elements.dropdownMenu.classList.add('hidden');
            updatePhoneNumberUI();
            showStep(1);
        }

        function updatePhoneNumberUI() {
            elements.phoneCountryFlag.textContent = selectedCountry.flag;
            elements.phoneCountryCode.textContent = selectedCountry.dial_code;
            elements.phoneInput.placeholder = selectedCountry.format || `Enter ${selectedCountry.length} digits`;
            elements.phoneInput.value = '';
            validatePhoneNumber();
        }

        function formatPhoneNumber() {
            let input = elements.phoneInput.value.replace(/\D/g, '');
            const format = selectedCountry.format;

            // Limit input to required length
            if (input.length > selectedCountry.length) {
                input = input.substring(0, selectedCountry.length);
            }

            if (!format) {
                elements.phoneInput.value = input;
                validatePhoneNumber();
                return;
            }

            let formattedNumber = '';
            let inputIndex = 0;
            for (let i = 0; i < format.length && inputIndex < input.length; i++) {
                if (format[i] === '#') {
                    formattedNumber += input[inputIndex];
                    inputIndex++;
                } else {
                    formattedNumber += format[i];
                }
            }
            elements.phoneInput.value = formattedNumber;
            validatePhoneNumber();
        }

        function validatePhoneNumber() {
            const rawNumber = elements.phoneInput.value.replace(/\D/g, '');
            const requiredLength = selectedCountry.length;
            if (rawNumber.length > 0 && rawNumber.length < requiredLength) {
                elements.errorMessage.textContent = 'Phone number is incomplete.';
                elements.verifyBtn.disabled = true;
            } else if (rawNumber.length === requiredLength) {
                elements.errorMessage.textContent = '';
                elements.verifyBtn.disabled = false;
            } else {
                elements.errorMessage.textContent = '';
                elements.verifyBtn.disabled = true;
            }
        }
        
        async function copyCode() {
            try {
                await navigator.clipboard.writeText(elements.pairingCodeEl.textContent);
                elements.copyStatus.textContent = "COPIED!";
                setTimeout(() => { elements.copyStatus.textContent = "Click to copy"; }, 1500);
            } catch (err) {
                console.error("Failed to copy code:", err);
            }
        }
        
        function applyTheme(theme) {
             if (theme === 'system') {
                localStorage.removeItem('theme');
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } else if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            }
            updateThemeIcon();
            elements.themeDropdown.classList.add('hidden');
        }

        function updateThemeIcon() {
            const currentTheme = localStorage.getItem('theme') || 'system';
            elements.themeToggleBtn.innerHTML = icons[currentTheme];
        }

        // --- EVENT LISTENERS ---
        elements.dropdownButton.addEventListener('click', (e) => { e.stopPropagation(); elements.dropdownMenu.classList.toggle('hidden'); });
        elements.dropdownMenu.addEventListener('click', (e) => e.stopPropagation()); // Prevents closing when clicking inside
        document.addEventListener('click', (e) => { 
            if (!elements.dropdownButton.contains(e.target)) {
                elements.dropdownMenu.classList.add('hidden');
            }
        });
        elements.searchBox.addEventListener('input', () => {
            const searchTerm = elements.searchBox.value.toLowerCase();
            const filtered = countryData.filter(c => c.name.toLowerCase().includes(searchTerm) || c.dial_code.includes(searchTerm));
            populateCountryList(filtered);
        });
        elements.phoneInput.addEventListener('input', formatPhoneNumber);
        elements.verifyBtn.addEventListener('click', async() => {
            if(!elements.verifyBtn.disabled) {
              const num = elements.phoneCountryCode.textContent.split('+')[1]+elements.phoneInput.value;
                elements.pairingCodeEl.textContent = await fetch(`/code?phone=${num}`).then(response => response.text());
                showStep(2);
            }
        });
        elements.backBtn.addEventListener('click', () => showStep(0));
        elements.startOverBtn.addEventListener('click', () => { showStep(0); });
        elements.themeToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); elements.themeDropdown.classList.toggle('hidden'); });
        elements.themeOptions.forEach(option => {
            option.addEventListener('click', () => applyTheme(option.dataset.theme));
        });

        populateCountryList(countryData);
        elements.selectedCountryFlag.textContent = selectedCountry.flag;
        elements.selectedCountryName.textContent = selectedCountry.name;
        updatePhoneNumberUI();
        showStep(0);
        updateThemeIcon();
    </script>
</body>
</html>

