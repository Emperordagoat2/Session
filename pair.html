<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Emperor Session</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<script src="https://cdn.tailwindcss.com"></script>
		<style>
			body {
				font-family: "Inter", sans-serif;
				background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
			}
			.glass-effect {
				background: rgba(30, 41, 59, 0.8);
				backdrop-filter: blur(20px);
				border: 1px solid rgba(148, 163, 184, 0.1);
			}
			.input-glow:focus {
				box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1),
					0 0 20px rgba(99, 102, 241, 0.3);
			}
			.btn-primary {
				background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
				transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			}
			.btn-primary:hover {
				transform: translateY(-2px);
				box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3);
				background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
			}
			.btn-primary:active {
				transform: translateY(0);
			}
			.code-display {
				background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
				animation: pulse 2s infinite;
			}
			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.8;
				}
			}
			.spinner {
				border: 3px solid rgba(99, 102, 241, 0.3);
				border-radius: 50%;
				border-top: 3px solid #6366f1;
				width: 20px;
				height: 20px;
				animation: spin 1s linear infinite;
			}
			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			input::-webkit-outer-spin-button,
			input::-webkit-inner-spin-button {
				-webkit-appearance: none;
				margin: 0;
			}
			input[type="number"] {
				-moz-appearance: textfield;
			}
		</style>
	</head>
	<body class="min-h-screen flex items-center justify-center p-4">
		<div class="container max-w-lg w-full">
			<div class="glass-effect rounded-2xl p-8 shadow-2xl">
				<div class="flex items-center justify-center mb-8">
					<div
						class="bg-gradient-to-r from-indigo-500 to-purple-600 p-3 rounded-full mr-3"
					>
						<svg
							class="w-6 h-6 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
							></path>
						</svg>
					</div>
					<h1 class="text-2xl font-bold text-white">Phone Pairing</h1>
				</div>

				<p class="text-slate-300 text-center mb-8 leading-relaxed">
					Connect your device by entering your phone number below. We'll send you a
					verification code.
				</p>

				<div class="space-y-6">
					<div class="space-y-2">
						<label for="countryCode" class="block text-sm font-medium text-slate-300"
							>Country</label
						>
						<select
							id="countryCode"
							class="w-full bg-slate-700/50 text-white rounded-xl px-4 py-4 border border-slate-600 focus:border-indigo-500 focus:outline-none input-glow transition-all"
						>
							<option value="+1-10">ğŸ‡ºğŸ‡¸ United States (+1)</option>
							<option value="+44-11">ğŸ‡¬ğŸ‡§ United Kingdom (+44)</option>
							<option value="+234-11">ğŸ‡³ğŸ‡¬ Nigeria (+234)</option>
							<option value="+91-10">ğŸ‡®ğŸ‡³ India (+91)</option>
							<option value="+81-11">ğŸ‡¯ğŸ‡µ Japan (+81)</option>
							<option value="+86-11">ğŸ‡¨ğŸ‡³ China (+86)</option>
							<option value="+33-10">ğŸ‡«ğŸ‡· France (+33)</option>
							<option value="+49-11">ğŸ‡©ğŸ‡ª Germany (+49)</option>
							<option value="+55-11">ğŸ‡§ğŸ‡· Brazil (+55)</option>
							<option value="+27-9">ğŸ‡¿ğŸ‡¦ South Africa (+27)</option>
							<option value="+62-11">ğŸ‡®ğŸ‡© Indonesia (+62)</option>
							<option value="+92-10">ğŸ‡µğŸ‡° Pakistan (+92)</option>
							<option value="+880-10">ğŸ‡§ğŸ‡© Bangladesh (+880)</option>
							<option value="+20-10">ğŸ‡ªğŸ‡¬ Egypt (+20)</option>
							<option value="+90-10">ğŸ‡¹ğŸ‡· Turkey (+90)</option>
							<option value="+966-9">ğŸ‡¸ğŸ‡¦ Saudi Arabia (+966)</option>
							<option value="+7-10">ğŸ‡·ğŸ‡º Russia (+7)</option>
							<option value="+34-9">ğŸ‡ªğŸ‡¸ Spain (+34)</option>
							<option value="+39-10">ğŸ‡®ğŸ‡¹ Italy (+39)</option>
							<option value="+212-9">ğŸ‡²ğŸ‡¦ Morocco (+212)</option>
							<option value="+971-9">ğŸ‡¦ğŸ‡ª United Arab Emirates (+971)</option>
							<option value="+964-10">ğŸ‡®ğŸ‡¶ Iraq (+964)</option>
							<option value="+98-10">ğŸ‡®ğŸ‡· Iran (+98)</option>
							<option value="+972-9">ğŸ‡®ğŸ‡± Israel (+972)</option>
							<option value="+351-9">ğŸ‡µğŸ‡¹ Portugal (+351)</option>
							<option value="+213-9">ğŸ‡©ğŸ‡¿ Algeria (+213)</option>
							<option value="+216-8">ğŸ‡¹ğŸ‡³ Tunisia (+216)</option>
							<option value="+254-9">ğŸ‡°ğŸ‡ª Kenya (+254)</option>
							<option value="+256-9">ğŸ‡ºğŸ‡¬ Uganda (+256)</option>
							<option value="+63-10">ğŸ‡µğŸ‡­ Philippines (+63)</option>
							<option value="+60-9">ğŸ‡²ğŸ‡¾ Malaysia (+60)</option>
							<option value="+66-9">ğŸ‡¹ğŸ‡­ Thailand (+66)</option>
							<option value="+84-9">ğŸ‡»ğŸ‡³ Vietnam (+84)</option>
							<option value="+94-9">ğŸ‡±ğŸ‡° Sri Lanka (+94)</option>
							<option value="+977-10">ğŸ‡³ğŸ‡µ Nepal (+977)</option>
							<option value="+251-9">ğŸ‡ªğŸ‡¹ Ethiopia (+251)</option>
							<option value="+593-9">ğŸ‡ªğŸ‡¨ Ecuador (+593)</option>
							<option value="+591-8">ğŸ‡§ğŸ‡´ Bolivia (+591)</option>
							<option value="+595-9">ğŸ‡µğŸ‡¾ Paraguay (+595)</option>
							<option value="+598-8">ğŸ‡ºğŸ‡¾ Uruguay (+598)</option>
							<option value="+56-9">ğŸ‡¨ğŸ‡± Chile (+56)</option>
							<option value="+57-10">ğŸ‡¨ğŸ‡´ Colombia (+57)</option>
							<option value="+58-10">ğŸ‡»ğŸ‡ª Venezuela (+58)</option>
							<option value="+52-10">ğŸ‡²ğŸ‡½ Mexico (+52)</option>
							<option value="+51-9">ğŸ‡µğŸ‡ª Peru (+51)</option>
							<option value="+54-10">ğŸ‡¦ğŸ‡· Argentina (+54)</option>
							<option value="+591-8">ğŸ‡§ğŸ‡´ Bolivia (+591)</option>
							<option value="+505-8">ğŸ‡³ğŸ‡® Nicaragua (+505)</option>
							<option value="+502-8">ğŸ‡¬ğŸ‡¹ Guatemala (+502)</option>
							<option value="+503-8">ğŸ‡¸ğŸ‡» El Salvador (+503)</option>
							<option value="+504-8">ğŸ‡­ğŸ‡³ Honduras (+504)</option>
							<option value="+505-8">ğŸ‡³ğŸ‡® Nicaragua (+505)</option>
							<option value="+506-8">ğŸ‡¨ğŸ‡· Costa Rica (+506)</option>
							<option value="+507-8">ğŸ‡µğŸ‡¦ Panama (+507)</option>
							<option value="+591-8">ğŸ‡§ğŸ‡´ Bolivia (+591)</option>
							<option value="+592-7">ğŸ‡¬ğŸ‡¾ Guyana (+592)</option>
							<option value="+593-9">ğŸ‡ªğŸ‡¨ Ecuador (+593)</option>
							<option value="+595-9">ğŸ‡µğŸ‡¾ Paraguay (+595)</option>
							<option value="+597-7">ğŸ‡¸ğŸ‡· Suriname (+597)</option>
							<option value="+598-8">ğŸ‡ºğŸ‡¾ Uruguay (+598)</option>
						</select>
					</div>

					<div class="space-y-2">
						<label for="phoneNumber" class="block text-sm font-medium text-slate-300"
							>Phone Number</label
						>
						<input
							type="tel"
							id="phoneNumber"
							placeholder="Enter your phone number"
							class="w-full bg-slate-700/50 text-white rounded-xl px-4 py-4 border border-slate-600 focus:border-indigo-500 focus:outline-none input-glow transition-all text-lg"
						/>
						<p id="validation-hint" class="text-xs text-slate-400"></p>
					</div>

					<button
						id="submitBtn"
						class="w-full btn-primary text-white px-6 py-4 rounded-xl font-semibold text-lg flex items-center justify-center space-x-2"
					>
						<span id="button-text">Get Pairing Code</span>
						<div id="loading-spinner" class="spinner hidden"></div>
					</button>
				</div>

				<div id="result" class="mt-6 text-center"></div>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
		<script>
			const elements = {
				result: document.getElementById("result"),
				submitBtn: document.getElementById("submitBtn"),
				phoneInput: document.getElementById("phoneNumber"),
				countrySelect: document.getElementById("countryCode"),
				buttonText: document.getElementById("button-text"),
				loadingSpinner: document.getElementById("loading-spinner"),
				validationHint: document.getElementById("validation-hint"),
			};

			const countryConfigs = {
				"+1": { length: 10, name: "US" },
				"+44": { length: 11, name: "UK" },
				"+234": { length: 11, name: "Nigeria" },
				"+91": { length: 10, name: "India" },
				"+81": { length: 11, name: "Japan" },
				"+86": { length: 11, name: "China" },
				"+33": { length: 10, name: "France" },
				"+49": { length: 11, name: "Germany" },
				"+55": { length: 11, name: "Brazil" },
				"+27": { length: 9, name: "South Africa" },
				"+880": { length: 10, name: "Bangladesh" },
				"+20": { length: 10, name: "Egypt" },
				"+90": { length: 10, name: "Turkey" },
				"+966": { length: 9, name: "Saudi Arabia" },
				"+7": { length: 10, name: "Russia" },
				"+34": { length: 9, name: "Spain" },
				"+39": { length: 10, name: "Italy" },
				"+212": { length: 9, name: "Morocco" },
				"+971": { length: 9, name: "United Arab Emirates" },
				"+964": { length: 10, name: "Iraq" },
				"+98": { length: 10, name: "Iran" },
				"+972": { length: 9, name: "Israel" },
				"+351": { length: 9, name: "Portugal" },
				"+213": { length: 9, name: "Algeria" },
				"+216": { length: 8, name: "Tunisia" },
				"+254": { length: 9, name: "Kenya" },
				"+256": { length: 9, name: "Uganda" },
				"+63": { length: 10, name: "Philippines" },
				"+60": { length: 9, name: "Malaysia" },
				"+66": { length: 9, name: "Thailand" },
				"+84": { length: 9, name: "Vietnam" },
				"+94": { length: 9, name: "Sri Lanka" },
				"+977": { length: 10, name: "Nepal" },
				"+251": { length: 9, name: "Ethiopia" },
				"+593": { length: 9, name: "Ecuador" },
				"+591": { length: 8, name: "Bolivia" },
				"+595": { length: 9, name: "Paraguay" },
				"+598": { length: 8, name: "Uruguay" },
				"+56": { length: 9, name: "Chile" },
				"+57": { length: 10, name: "Colombia" },
				"+58": { length: 10, name: "Venezuela" },
				"+52": { length: 10, name: "Mexico" },
				"+51": { length: 9, name: "Peru" },
				"+54": { length: 10, name: "Argentina" },
				"+505": { length: 8, name: "Nicaragua" },
				"+502": { length: 8, name: "Guatemala" },
				"+503": { length: 8, name: "El Salvador" },
				"+504": { length: 8, name: "Honduras" },
				"+506": { length: 8, name: "Costa Rica" },
				"+507": { length: 8, name: "Panama" },
				"+592": { length: 7, name: "Guyana" },
				"+597": { length: 7, name: "Suriname" },
			};

			function updateValidationHint() {
				const [countryCode] = elements.countrySelect.value.split("-");
				const config = countryConfigs[countryCode];
				if (config) {
					elements.validationHint.textContent = `Enter ${config.length} digits for ${config.name}`;
				}
			}

			function formatPhoneNumber(number, countryCode) {
				const digits = number.replace(/\D/g, "");
				let formatted = "";

				if (countryCode === "+1") {
					formatted = digits.replace(/(\d{3})(\d{3})(\d{4})/, "$1-$2-$3");
				} else {
					formatted = digits.replace(/(\d{3})/g, "$1 ").trim();
				}

				return formatted;
			}

			function sanitizePhoneInput(value) {
				return value.replace(/[^\d]/g, "");
			}

			function showResult(message, type = "info") {
				const colors = {
					error: "text-red-400 bg-red-900/20 border-red-500/30",
					success: "text-green-400 bg-green-900/20 border-green-500/30",
					info: "text-blue-400 bg-blue-900/20 border-blue-500/30",
				};

				elements.result.innerHTML = `
					<div class="p-4 rounded-xl border ${colors[type]}">
						${message}
					</div>
				`;
			}

			function showCode(code) {
				elements.result.innerHTML = `
					<div class="code-display p-6 rounded-xl text-center cursor-pointer" onclick="copyCode('${code}')">
						<p class="text-white font-bold text-xl">Pairing Code</p>
						<p id="code-display" class="text-white text-3xl font-mono mt-2 tracking-wider">${code}</p>
						<p class="text-white/80 text-sm mt-2">Click to copy</p>
					</div>
				`;
			}

			async function copyCode(code) {
				try {
					await navigator.clipboard.writeText(code);
					const codeDisplay = document.getElementById("code-display");
					const originalText = codeDisplay.textContent;
					codeDisplay.textContent = "COPIED!";
					setTimeout(() => {
						codeDisplay.textContent = originalText;
					}, 1000);
				} catch (err) {
					console.error("Failed to copy:", err);
				}
			}

			function setLoading(loading) {
				if (loading) {
					elements.buttonText.textContent = "Processing...";
					elements.loadingSpinner.classList.remove("hidden");
					elements.submitBtn.disabled = true;
					elements.submitBtn.classList.add("opacity-75", "cursor-not-allowed");
				} else {
					elements.buttonText.textContent = "Get Verification Code";
					elements.loadingSpinner.classList.add("hidden");
					elements.submitBtn.disabled = false;
					elements.submitBtn.classList.remove("opacity-75", "cursor-not-allowed");
				}
			}

			elements.countrySelect.addEventListener("change", updateValidationHint);

			elements.phoneInput.addEventListener("input", e => {
				const sanitized = sanitizePhoneInput(e.target.value);
				const [countryCode] = elements.countrySelect.value.split("-");
				e.target.value = formatPhoneNumber(sanitized, countryCode);
			});

			elements.submitBtn.addEventListener("click", async e => {
				e.preventDefault();

				const [countryCode, expectedLength] =
					elements.countrySelect.value.split("-");
				const phoneNumber = sanitizePhoneInput(elements.phoneInput.value);
				const requiredLength = parseInt(expectedLength);

				if (!phoneNumber) {
					showResult("Please enter your phone number", "error");
					return;
				}

				if (phoneNumber.length > requiredLength) {
					showResult(
						`Phone number must be exactly ${requiredLength} digits for ${countryConfigs[countryCode].name}`,
						"error"
					);
					return;
				}

				const fullNumber = countryCode.replace("+", "") + phoneNumber;

				try {
					setLoading(true);
					elements.result.innerHTML = "";

					const { data } = await axios.get(`/code?phone=${fullNumber}`);

					if (data && data.code) {
						showCode(data.code);
					} else {
						showResult("Verification code sent successfully!", "success");
					}
				} catch (error) {
					console.error("Request failed:", error);
					showResult("Failed to send verification code. Please try again.", "error");
				} finally {
					setLoading(false);
				}
			});

			updateValidationHint();
		</script>
	</body>
</html>
